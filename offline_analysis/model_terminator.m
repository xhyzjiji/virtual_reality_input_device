clc, clear;
%{
model is:
 Ax     Rx     Kx Mxy Mxz  ax     Bx
(Ay) = (Ry) + (Myx Ky Myz)(ay) + (By)
 Az     Rz     Mzx Mzy Kz  az     Bz
 --    ----    ----------         --
  A     LF          K              B
当物体静置时,
     ax     0
 C'*(ay) = (0)
     az     1
so,
 ax       0
(ay) = C*(0)
 az       1

拆分矩阵式为方程组:
Ax1 = Kx*ax1 + Mxy*ay1 + Mxz*az1 + Bx
Ax2 = Kx*ax2 + Mxy*ay2 + Mxz*az2 + Bx
Ax3 = Kx*ax3 + Mxy*ay3 + Mxz*az3 + Bx
Ax4 = Kx*ax4 + Mxy*ay4 + Mxz*az4 + Bx
其中,Axk axk ayk azk 为第k次标定所得值

 ax2-ax1 ay2-ay1 az2-az1  Kx      Ax2-Ax1
(ax3-ax2 ay3-ay2 az3-az2)(Mxy) = (Ax3-Ax2)
 ax4-ax3 ay4-ay3 az4-az3  Mxz     Ax4-Ax3

At last,
 ax
(ay) = K \ (A - B)
 az
%}   

% test1
% A = [0.001917974947808 -0.141913517745301 1.034725949895611;
%       -0.054878393393394 -0.386963213213214 0.965478318318319;
%       0.261942518409425 -0.445952002945509 0.895611531664212;
%       -0.029936078431373 -0.424684811463048 0.948231327300154];
% E = [43.173758089770331 0.083025584551148 -7.786847108559513;
%      19.978687417417383 -3.023891096096103 -21.833201036036048;
%      11.927453063328398 14.674921163475718 -26.431755861561143;
%      27.456740346908099 -1.685771372549019 -24.171186410256418];

% test2
A = [0.016507280701754 0.011567280701754 -1.003683771929826;
    0.016682500000000 -0.400390245535714 -0.916014843749999;
    0.286754452380952 0.065219023809524 -0.961521785714284;
    0.024583626373626 0.411878076923078 -0.918585467032969];
E = [-0.961019276315790 1.793380758114032e+02 -54.177616271929899;
    -0.951406964285714 -1.564248442187499e+02 -1.569712770089287e+02;
    -16.553223380952407 1.761849597857144e+02 -1.512268620238096e+02;
    -1.413064890109890 1.559494359615387e+02 -1.440041747527473e+02];
 
[m,~] = size(E);
C = cell(1,m);
for i = 1:m
    temp = rotate_euler(E(i,3), E(i,2), E(i,1));
    C(1,i) = {temp}; %C
end

as = zeros(m, 3);
for i = 1:m
    temp = cell2mat(C(1,i))*[0 0 1]';
    as(i,:) = temp';
end

a_coe = zeros(m-1, 3);
for i = 1:m-1
    a_coe(i,:) = as(i+1,:) - as(1,:);
end

A_coe = zeros(m-1, 3);
for i = 1:m-1
    A_coe(i,:) = A(i+1,:) - A(1,:);
end

ax_coe = a_coe \ A_coe(:,1);
ax_coe = ax_coe';
Bx = A(1,1) - ax_coe*as(1,:)';
ay_coe = a_coe \ A_coe(:,2);
ay_coe = ay_coe';
By = A(1,2) - ay_coe*as(1,:)';
az_coe = a_coe \ A_coe(:,3);
az_coe = az_coe';
Bz = A(1,3) - az_coe*as(1,:)';

K = [ax_coe; ay_coe; az_coe];
B = [Bx, By, Bz];
